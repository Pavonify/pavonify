{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Assignment Analytics - {{ assignment.name }}</title>
  <link rel="icon" href="{% static 'images/favicon.ico' %}" type="image/x-icon">
  <!-- Optionally include Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    /* Basic Reset and Fonts */
    *, *::before, *::after { box-sizing: border-box; }
    body {
      font-family: Arial, sans-serif;
      background: #e3f2fd;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: #fff;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    /* Top Navigation Bar */
    .top-nav {
      background-color: var(--primary, #1A73E8);
      color: #fff;
      padding: 8px 20px;
      display: flex;
      align-items: center;
      margin-bottom: 20px;
    }
    .top-nav a {
      color: #fff;
      text-decoration: none;
      font-weight: 600;
      font-size: 16px;
    }
    /* Tabs */
    .tabs {
      display: flex;
      border-bottom: 2px solid #ddd;
      margin-bottom: 20px;
    }
    .tab {
      padding: 10px 20px;
      cursor: pointer;
      font-weight: bold;
      border: 1px solid transparent;
      border-top-left-radius: 10px;
      border-top-right-radius: 10px;
      margin-right: 5px;
    }
    .tab.active {
      border: 1px solid #ddd;
      border-bottom: 2px solid #fff;
      background: #f9f9f9;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    /* Tables */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }
    table, th, td { border: 1px solid #ddd; }
    th, td { padding: 10px; text-align: center; font-size: 16px; }
    th { background: #0aa2ef; color: #fff; }
    tr:nth-child(even) { background: #f9f9f9; }
    /* Difficulty Meter */
    .difficulty-bar {
      height: 10px;
      background: red;
      width: 0%;
      transition: width 0.3s;
    }
    /* Word Clouds */
    .word-cloud {
      border: 1px solid #ddd;
      padding: 10px;
      min-height: 100px;
      margin-bottom: 20px;
    }
    .word-cloud span {
      margin: 5px;
      display: inline-block;
    }
  </style>
</head>
<body>
  <!-- Top Navigation Bar -->
  <div class="top-nav">
    <a href="{% url 'teacher_dashboard' %}?pane=classes">&larr; Back to Dashboard</a>
  </div>
  
  <div class="container">
    <h1>Assignment Analytics: {{ assignment.name }}</h1>
    
    <!-- Tab Navigation -->
    <div class="tabs">
      <div class="tab active" data-tab="overview">Overview</div>
      <div class="tab" data-tab="student-summary">Student Summary</div>
      <div class="tab" data-tab="word-summary">Word Summary</div>
      <div class="tab" data-tab="feedback">Feedback</div>
    </div>
    
    <!-- Overview Tab -->
    <div class="tab-content active" id="overview">
      <h2>Overview</h2>
      <table>
        <thead>
          <tr>
            <th>Student</th>
            <th>Points Earned</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          {% for progress in progress_list %}
          <tr>
            <td>{{ progress.student.username }}</td>
            <td>{{ progress.points_earned }}</td>
            <td>
              {% if progress.completed or progress.points_earned >= assignment.target_points %}
                <span style="color:green;"><i class="fas fa-check-circle"></i> Completed</span>
              {% else %}
                <span style="color:red;"><i class="fas fa-times-circle"></i> Incomplete</span>
              {% endif %}
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="3">No progress data available.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    
    <!-- Student Summary Tab -->
    <div class="tab-content" id="student-summary">
      <h2>Student Summary</h2>
      <table>
        <thead>
          <tr>
            <th>Student</th>
            <th>Words Aced ðŸ’ª</th>
            <th>Attempts Wrong ðŸ‘Ž</th>
          </tr>
        </thead>
        <tbody>
          {% for summary in student_summary %}
          <tr>
            <td>{{ summary.student.first_name }} {{ summary.student.last_name }}</td>
            <td>
              {% for word in summary.words_aced %}
                {{ word }}<br>
              {% endfor %}
            </td>
            <td>
              {% for word, count in summary.attempts_wrong %}
                {{ word }} ({{ count }})<br>
              {% endfor %}
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="3">No student summary data available.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    
    <!-- Word Summary Tab -->
    <div class="tab-content" id="word-summary">
      <h2>Word Summary</h2>
      <table>
        <thead>
          <tr>
            <th>Word</th>
            <th>Difficulty Meter</th>
            <th>Student Count</th>
          </tr>
        </thead>
        <tbody>
          {% for word in word_summary %}
          <tr>
            <td>{{ word.word }}</td>
            <td>
              <div class="difficulty-bar" style="width: {{ word.wrong_attempts|floatformat:0 }}%;"></div>
            </td>
            <td>{{ word.students_difficulty }} students found this word difficult</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="3">No word summary data available.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    
    <!-- Feedback Tab -->
    <div class="tab-content" id="feedback">
      <h2>Feedback</h2>
      <div>
        <h3>Word Cloud (Easy)</h3>
        <div class="word-cloud">
          {% for word in word_cloud_easy %}
            <span style="font-size: {{ word|length }}px;">{{ word }} </span>
          {% endfor %}
        </div>
      </div>
      <div>
        <h3>Word Cloud (Difficult)</h3>
        <div class="word-cloud">
          {% for word in word_cloud_difficult %}
            <span style="font-size: {{ word|length }}px;">{{ word }} </span>
          {% endfor %}
        </div>
      </div>
      <div>
        <h3>Top 10 Difficult Words</h3>
        <ol>
          {% for word in top_difficult_words %}
            <li>{{ word.word }} - {{ word.students_difficulty }} students</li>
          {% empty %}
            <li>No data available.</li>
          {% endfor %}
        </ol>
      </div>
    </div>
  </div>
  
  <script>
    // Simple tab-switching logic.
    const tabs = document.querySelectorAll(".tab");
    const tabContents = document.querySelectorAll(".tab-content");
    tabs.forEach(tab => {
      tab.addEventListener("click", () => {
        tabs.forEach(t => t.classList.remove("active"));
        tabContents.forEach(tc => tc.classList.remove("active"));
        tab.classList.add("active");
        document.getElementById(tab.getAttribute("data-tab")).classList.add("active");
      });
    });
  </script>
</body>
</html>
