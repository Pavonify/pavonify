<div id="wizard-basics" hx-target="this" hx-swap="outerHTML" class="space-y-6">
    <form hx-post="{% url 'sportsday:meet-wizard-stage' %}?step=basics" hx-target="#wizard-basics" hx-swap="outerHTML" class="space-y-6">
        {% csrf_token %}
        {% if saved %}
            <div class="rounded-xl border border-emerald-500/50 bg-emerald-500/10 px-4 py-3 text-sm text-emerald-200">
                Meet details saved. Continue to build events or refine the basics at any time.
            </div>
        {% endif %}
        {% if form.non_field_errors %}
            <div class="rounded-xl border border-rose-500/60 bg-rose-500/10 px-4 py-3 text-sm text-rose-200">
                {% for error in form.non_field_errors %}
                    <div>{{ error }}</div>
                {% endfor %}
            </div>
        {% endif %}
        <div class="grid gap-4 md:grid-cols-2">
            <div class="space-y-2">
                <label class="text-sm font-medium text-slate-200" for="id_name">Meet name</label>
                <input type="text" name="name" id="id_name" value="{{ form.name.value|default:'' }}" placeholder="Spring Athletics Carnival" class="w-full rounded-lg border border-slate-700 bg-slate-950/60 px-3 py-2 text-sm text-slate-100 focus:border-sky-500 focus:outline-none" hx-get="{% url 'sportsday:meet-slugify' %}" hx-trigger="keyup changed delay:400ms" hx-target="#slug-field" />
                {% if form.name.errors %}
                    <p class="text-xs text-rose-300">{{ form.name.errors|join:', ' }}</p>
                {% endif %}
            </div>
            {% include "sportsday/partials/wizard_slug_field.html" with value=form.slug.value errors=form.slug.errors %}
            <div class="space-y-2">
                <label class="text-sm font-medium text-slate-200" for="id_date">Date</label>
                <input type="date" name="date" id="id_date" value="{{ form.date.value|default:'' }}" class="w-full rounded-lg border border-slate-700 bg-slate-950/60 px-3 py-2 text-sm text-slate-100 focus:border-sky-500 focus:outline-none" required />
                {% if form.date.errors %}
                    <p class="text-xs text-rose-300">{{ form.date.errors|join:', ' }}</p>
                {% endif %}
            </div>
            <div class="space-y-2">
                <label class="text-sm font-medium text-slate-200" for="id_location">Location</label>
                <input type="text" name="location" id="id_location" value="{{ form.location.value|default:'' }}" placeholder="Main Oval" class="w-full rounded-lg border border-slate-700 bg-slate-950/60 px-3 py-2 text-sm text-slate-100 focus:border-sky-500 focus:outline-none" />
                {% if form.location.errors %}
                    <p class="text-xs text-rose-300">{{ form.location.errors|join:', ' }}</p>
                {% endif %}
            </div>
            <div class="space-y-2">
                <label class="text-sm font-medium text-slate-200" for="id_start_time">Start time</label>
                <input type="time" name="start_time" id="id_start_time" value="{{ form.start_time.value|default:'' }}" class="w-full rounded-lg border border-slate-700 bg-slate-950/60 px-3 py-2 text-sm text-slate-100 focus:border-sky-500 focus:outline-none" />
                {% if form.start_time.errors %}
                    <p class="text-xs text-rose-300">{{ form.start_time.errors|join:', ' }}</p>
                {% endif %}
            </div>
            <div class="space-y-2">
                <label class="text-sm font-medium text-slate-200" for="id_end_time">End time</label>
                <input type="time" name="end_time" id="id_end_time" value="{{ form.end_time.value|default:'' }}" class="w-full rounded-lg border border-slate-700 bg-slate-950/60 px-3 py-2 text-sm text-slate-100 focus:border-sky-500 focus:outline-none" />
                {% if form.end_time.errors %}
                    <p class="text-xs text-rose-300">{{ form.end_time.errors|join:', ' }}</p>
                {% endif %}
            </div>
            <div class="space-y-2">
                <label class="text-sm font-medium text-slate-200" for="id_max_events">Max events per student</label>
                <input type="number" name="max_events_per_student" id="id_max_events" min="1" value="{{ form.max_events_per_student.value|default:3 }}" class="w-full rounded-lg border border-slate-700 bg-slate-950/60 px-3 py-2 text-sm text-slate-100 focus:border-sky-500 focus:outline-none" />
                {% if form.max_events_per_student.errors %}
                    <p class="text-xs text-rose-300">{{ form.max_events_per_student.errors|join:', ' }}</p>
                {% endif %}
            </div>
            <div class="space-y-2 md:col-span-2">
                <label class="text-sm font-medium text-slate-200" for="id_notes">Notes</label>
                <textarea name="notes" id="id_notes" rows="3" placeholder="Logistics, transport, weather contingenciesâ€¦" class="w-full rounded-lg border border-slate-700 bg-slate-950/60 px-3 py-2 text-sm text-slate-100 focus:border-sky-500 focus:outline-none">{{ form.notes.value|default:'' }}</textarea>
                {% if form.notes.errors %}
                    <p class="text-xs text-rose-300">{{ form.notes.errors|join:', ' }}</p>
                {% endif %}
            </div>
        </div>
        <div class="rounded-xl border border-slate-800 bg-slate-900/40 p-4">
            <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
                <div>
                    <h3 class="text-sm font-semibold text-slate-200">Scoring settings</h3>
                    <p class="text-xs text-slate-400">Pick a preset or fine-tune points and participation awards.</p>
                </div>
            </div>
            <div class="mt-4 grid gap-4 md:grid-cols-3">
                <div class="space-y-2">
                    <label class="text-sm font-medium text-slate-200" for="id_scoring_preset">Preset</label>
                    <select name="scoring_preset" id="id_scoring_preset" class="w-full rounded-lg border border-slate-700 bg-slate-950/60 px-3 py-2 text-sm text-slate-100 focus:border-sky-500 focus:outline-none" hx-get="{% url 'sportsday:meet-wizard-scoring-preview' %}" hx-trigger="change" hx-target="#scoring-preview" hx-include="closest form">
                        {% for value, label in form.fields.scoring_preset.choices %}
                            <option value="{{ value }}" {% if form.scoring_preset.value == value %}selected{% endif %}>{{ label }}</option>
                        {% endfor %}
                    </select>
                    {% if form.scoring_preset.errors %}
                        <p class="text-xs text-rose-300">{{ form.scoring_preset.errors|join:', ' }}</p>
                    {% endif %}
                </div>
                <div class="space-y-2">
                    <label class="text-sm font-medium text-slate-200" for="id_points_csv">Points CSV</label>
                    <input type="text" name="points_csv" id="id_points_csv" value="{{ form.points_csv.value|default:'' }}" class="w-full rounded-lg border border-slate-700 bg-slate-950/60 px-3 py-2 text-sm text-slate-100 focus:border-sky-500 focus:outline-none" />
                    {% if form.points_csv.errors %}
                        <p class="text-xs text-rose-300">{{ form.points_csv.errors|join:', ' }}</p>
                    {% endif %}
                </div>
                <div class="space-y-2">
                    <label class="text-sm font-medium text-slate-200" for="id_participation_point">Participation</label>
                    <input type="number" step="0.01" name="participation_point" id="id_participation_point" value="{{ form.participation_point.value|default:'' }}" class="w-full rounded-lg border border-slate-700 bg-slate-950/60 px-3 py-2 text-sm text-slate-100 focus:border-sky-500 focus:outline-none" />
                    {% if form.participation_point.errors %}
                        <p class="text-xs text-rose-300">{{ form.participation_point.errors|join:', ' }}</p>
                    {% endif %}
                </div>
                <div class="space-y-2 md:col-span-3 lg:col-span-1">
                    <label class="text-sm font-medium text-slate-200" for="id_tie_method">Tie method</label>
                    <select name="tie_method" id="id_tie_method" class="w-full rounded-lg border border-slate-700 bg-slate-950/60 px-3 py-2 text-sm text-slate-100 focus:border-sky-500 focus:outline-none">
                        {% for value, label in form.fields.tie_method.choices %}
                            <option value="{{ value }}" {% if form.tie_method.value == value %}selected{% endif %}>{{ label }}</option>
                        {% endfor %}
                    </select>
                    {% if form.tie_method.errors %}
                        <p class="text-xs text-rose-300">{{ form.tie_method.errors|join:', ' }}</p>
                    {% endif %}
                </div>
            </div>
            <div id="scoring-preview" class="mt-4" hx-target="this" hx-swap="innerHTML">
                {% include "sportsday/partials/wizard_scoring_preview.html" with points_csv=scoring_preview.points_csv participation_point=scoring_preview.participation_point %}
            </div>
        </div>
        <div class="flex justify-end">
            <button type="submit" class="inline-flex items-center gap-2 rounded-full bg-sky-500 px-5 py-2 text-sm font-medium text-slate-900 shadow-lg shadow-sky-500/40 hover:bg-sky-400">Save basics</button>
        </div>
    </form>
</div>
