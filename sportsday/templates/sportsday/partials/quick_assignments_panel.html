<div
    id="quick-assignments-panel"
    class="space-y-6 rounded-2xl border border-slate-800 bg-slate-900/60 p-4"
    data-focus-target="{{ focus_target }}"
>
    <form
        method="post"
        class="flex flex-col gap-3 lg:flex-row lg:items-end"
        data-quick-form
        hx-post="{% url 'sportsday:quick-assignments' %}{% if active_meet %}?meet={{ active_meet.slug }}{% endif %}"
        hx-target="#quick-assignments-panel"
        hx-swap="outerHTML"
    >
        {% csrf_token %}
        {% if active_meet %}
            <input type="hidden" name="meet" value="{{ active_meet.slug }}" />
        {% endif %}
        <input type="hidden" name="student_id" id="student-id" value="{{ form_state.student_id }}" />
        <input type="hidden" name="event_id" id="event-id" value="{{ form_state.event_id }}" />
        <label class="w-full space-y-1 text-xs uppercase tracking-widest text-slate-400 lg:w-32">
            Action
            <select
                name="mode"
                class="w-full rounded-lg border border-slate-700 bg-slate-950/60 px-3 py-2 text-sm text-slate-100"
                data-mode-select
            >
                <option value="add" {% if form_state.mode != 'remove' %}selected{% endif %}>Add</option>
                <option value="remove" {% if form_state.mode == 'remove' %}selected{% endif %}>Remove</option>
            </select>
        </label>
        <div class="flex-1 space-y-1 text-xs uppercase tracking-widest text-slate-400">
            <div class="text-xs uppercase tracking-widest text-slate-400">Student</div>
            <div class="relative">
                <input
                    type="text"
                    name="q"
                    id="student-input"
                    value="{{ form_state.student_query }}"
                    placeholder="Search students"
                    class="w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 focus:border-sky-400 focus:ring focus:ring-sky-200"
                    autocomplete="off"
                    hx-get="{% url 'sportsday:quick-assignments-student-search' %}"
                    hx-trigger="keyup changed delay:300ms"
                    hx-target="#student-suggestions"
                    data-autocomplete-input
                    data-hidden-field="#student-id"
                    data-suggestions-target="student-suggestions"
                    data-next-focus="#event-input"
                    data-related-input="#event-input"
                    data-focus="student"
                    data-shift-submit
                />
                <div
                    id="student-suggestions"
                    class="absolute left-0 right-0 top-full z-20 mt-1"
                    data-suggestion-container
                >
                    {% include "sportsday/partials/quick_assignments_student_suggestions.html" with helper_text=student_helper_text %}
                </div>
            </div>
            {% if student_error_message %}
                <p class="text-xs font-medium text-rose-500">{{ student_error_message }}</p>
            {% endif %}
            {% if selected_student %}
                <p class="text-[0.65rem] uppercase tracking-widest text-slate-500">
                    {{ selected_student.grade }} · {{ selected_student.house }}
                </p>
            {% endif %}
        </div>
        <span class="text-center text-sm font-semibold text-slate-200 lg:w-16" data-mode-label>
            {% if form_state.mode == 'remove' %}from{% else %}to{% endif %}
        </span>
        <div class="flex-1 space-y-1 text-xs uppercase tracking-widest text-slate-400">
            <div class="text-xs uppercase tracking-widest text-slate-400">Event</div>
            <div class="relative">
                <input
                    type="text"
                    name="event_query"
                    id="event-input"
                    value="{{ form_state.event_query }}"
                    placeholder="Search events"
                    class="w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 focus:border-sky-400 focus:ring focus:ring-sky-200"
                    autocomplete="off"
                    hx-get="{% url 'sportsday:quick-assignments-events' %}"
                    hx-trigger="keyup changed delay:300ms"
                    hx-target="#event-suggestions"
                    hx-include="#student-id, [name='mode'], [name='meet']"
                    data-autocomplete-input
                    data-hidden-field="#event-id"
                    data-suggestions-target="event-suggestions"
                    data-focus="event"
                    data-shift-submit
                />
                <div
                    id="event-suggestions"
                    class="absolute left-0 right-0 top-full z-20 mt-1"
                    data-suggestion-container
                >
                    {% include "sportsday/partials/quick_assignments_event_suggestions.html" with helper_text=event_helper_text %}
                </div>
            </div>
        </div>
        <div class="flex items-end lg:items-center">
            <button
                type="submit"
                class="inline-flex items-center gap-2 rounded-full bg-sky-500 px-4 py-2 text-sm font-medium text-slate-950 shadow-lg shadow-sky-500/40 hover:bg-sky-400"
            >
                Submit
                <span class="text-xs font-normal text-slate-800">⇧ + Enter</span>
            </button>
        </div>
    </form>
    {% if error_message %}
        <p class="text-sm text-rose-300">{{ error_message }}</p>
    {% endif %}
    {% if info_message %}
        <p class="text-sm text-emerald-300">{{ info_message }}</p>
    {% endif %}

    {% include "sportsday/partials/quick_assignments_log.html" %}
</div>
