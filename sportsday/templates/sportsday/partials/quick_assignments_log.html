<div class="space-y-3">
    <div class="flex items-center justify-between">
        <div>
            <p class="text-xs uppercase tracking-widest text-slate-400">Live changelog</p>
            <p class="text-sm text-slate-500">Most recent changes appear first.</p>
        </div>
    </div>
    <div class="max-h-80 overflow-y-auto rounded-2xl border border-slate-800 bg-slate-950/40">
        {% if log_entries %}
            <ul class="divide-y divide-slate-800 text-sm">
                {% for entry in log_entries %}
                    <li class="flex flex-col gap-2 px-4 py-3 sm:flex-row sm:items-center sm:justify-between">
                        <div>
                            <p class="text-xs uppercase tracking-widest text-slate-500">
                                {% if entry.timestamp_obj %}
                                    {{ entry.timestamp_obj|date:"H:i:s" }}
                                {% endif %}
                                Â· {{ entry.user_name }}
                            </p>
                            <p class="text-sm text-slate-100">
                                {% if entry.action == 'add' %}
                                    Added {{ entry.student_name }} to {{ entry.event_name }}
                                {% else %}
                                    Removed {{ entry.student_name }} from {{ entry.event_name }}
                                {% endif %}
                            </p>
                            {% if entry.undone %}
                                <p class="text-xs text-amber-300">
                                    Undone{% if entry.undo_timestamp_obj %} at {{ entry.undo_timestamp_obj|date:"H:i:s" }}{% endif %}
                                </p>
                            {% endif %}
                        </div>
                        {% if not entry.undone %}
                            <form
                                method="post"
                                class="self-start"
                                hx-post="{% url 'sportsday:quick-assignments-undo' %}{% if active_meet %}?meet={{ active_meet.slug }}{% endif %}"
                                hx-target="#quick-assignments-panel"
                                hx-swap="outerHTML"
                            >
                                {% csrf_token %}
                                {% if active_meet %}
                                    <input type="hidden" name="meet" value="{{ active_meet.slug }}" />
                                {% endif %}
                                <input type="hidden" name="change_id" value="{{ entry.id }}" />
                                <input type="hidden" name="mode" value="{{ form_state.mode }}" />
                                <input type="hidden" name="student_id" value="{{ form_state.student_id }}" />
                                <input type="hidden" name="student_query" value="{{ form_state.student_query }}" />
                                <input type="hidden" name="event_id" value="{{ form_state.event_id }}" />
                                <input type="hidden" name="event_query" value="{{ form_state.event_query }}" />
                                <button type="submit" class="inline-flex items-center gap-2 rounded-full border border-slate-700 px-3 py-1 text-xs uppercase tracking-widest text-slate-300 hover:border-sky-500/40 hover:text-sky-200">
                                    Undo
                                </button>
                            </form>
                        {% else %}
                            <span class="rounded-full border border-amber-400/40 px-3 py-1 text-xs uppercase tracking-widest text-amber-300">Undone</span>
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="px-4 py-6 text-sm text-slate-400">No changes yet. Submissions will appear here with undo buttons.</p>
        {% endif %}
    </div>
</div>
