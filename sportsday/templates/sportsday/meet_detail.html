{% extends "sportsday/base.html" %}
{% block title %}Sports Day · {{ meet.name }}{% endblock %}
{% block content %}
<section class="space-y-6">
    <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
        <div>
            <p class="text-sm uppercase tracking-widest text-slate-400">Meet hub</p>
            <h1 class="text-2xl font-semibold">{{ meet.name }}</h1>
            <p class="text-sm text-slate-400">{{ meet.date|date:"l, j F Y" }} · {{ meet.location|default:"Venue TBC" }}</p>
        </div>
        <div class="flex flex-wrap gap-2">
            <a href="{% url 'sportsday:meet-update' meet.slug %}" class="inline-flex items-center gap-2 rounded-full border border-slate-700 px-4 py-2 text-sm text-slate-300 hover:border-sky-500/40 hover:text-sky-200">Edit meet</a>
            <a href="{% url 'sportsday:event-create' %}?meet={{ meet.slug }}" class="inline-flex items-center gap-2 rounded-full border border-slate-700 px-4 py-2 text-sm text-slate-300 hover:border-sky-500/40 hover:text-sky-200">Add event</a>
            <a href="{% url 'sportsday:events' %}?meet={{ meet.slug }}" class="inline-flex items-center gap-2 rounded-full border border-slate-700 px-4 py-2 text-sm text-slate-300 hover:border-sky-500/40 hover:text-sky-200">View events</a>
            <a href="{% url 'sportsday:students' %}?meet={{ meet.slug }}" class="inline-flex items-center gap-2 rounded-full border border-slate-700 px-4 py-2 text-sm text-slate-300 hover:border-sky-500/40 hover:text-sky-200">Students</a>
            <form method="post" action="{% url 'sportsday:meet-toggle-lock' meet.slug %}" hx-post="{% url 'sportsday:meet-toggle-lock' meet.slug %}" hx-target="closest section" hx-swap="outerHTML">
                {% csrf_token %}
                {% if meet.is_locked %}
                    <input type="hidden" name="action" value="unlock">
                    <button type="submit" class="inline-flex items-center gap-2 rounded-full bg-emerald-500 px-4 py-2 text-sm font-medium text-emerald-950 shadow-lg shadow-emerald-500/40 hover:bg-emerald-400">Unlock meet</button>
                {% else %}
                    <input type="hidden" name="action" value="lock">
                    <button type="submit" class="inline-flex items-center gap-2 rounded-full bg-rose-500 px-4 py-2 text-sm font-medium text-rose-950 shadow-lg shadow-rose-500/40 hover:bg-rose-400">Lock meet</button>
                {% endif %}
            </form>
            <form method="post" action="{% url 'sportsday:meet-delete' meet.slug %}" onsubmit="return confirm('Delete this meet and all associated data?');">
                {% csrf_token %}
                <button type="submit" class="inline-flex items-center gap-2 rounded-full border border-rose-500/60 px-4 py-2 text-sm text-rose-500 hover:border-rose-500 hover:text-rose-600">Delete</button>
            </form>
        </div>
    </div>

    <nav class="overflow-x-auto">
        <ul class="flex gap-3 rounded-full border border-slate-800 bg-slate-900/60 p-2 text-sm text-slate-300">
            <li><a href="#tab-overview" class="inline-flex items-center gap-2 rounded-full px-4 py-2 hover:bg-slate-800">Overview</a></li>
            <li><a href="#tab-events" class="inline-flex items-center gap-2 rounded-full px-4 py-2 hover:bg-slate-800">Events</a></li>
            <li><a href="#tab-entries" class="inline-flex items-center gap-2 rounded-full px-4 py-2 hover:bg-slate-800">Entries</a></li>
            <li><a href="#tab-scoring" class="inline-flex items-center gap-2 rounded-full px-4 py-2 hover:bg-slate-800">Scoring</a></li>
            <li><a href="#tab-exports" class="inline-flex items-center gap-2 rounded-full px-4 py-2 hover:bg-slate-800">Exports</a></li>
        </ul>
    </nav>

    <section id="tab-overview" class="grid gap-4 lg:grid-cols-3">
        <article class="rounded-2xl border border-slate-800 bg-slate-900/60 p-5 lg:col-span-2" hx-get="{% url 'sportsday:meet-schedule-fragment' meet.slug %}" hx-trigger="load">
            <div class="rounded-xl border border-slate-800 bg-slate-950/60 p-4 text-sm text-slate-400">Loading schedule…</div>
        </article>
        <article class="rounded-2xl border border-slate-800 bg-slate-900/60 p-5" hx-get="{% url 'sportsday:meet-people-fragment' meet.slug %}" hx-trigger="load">
            <div class="rounded-xl border border-slate-800 bg-slate-950/60 p-4 text-sm text-slate-400">Fetching allocations…</div>
        </article>
    </section>

    <section id="tab-events" class="rounded-2xl border border-slate-800 bg-slate-900/60 p-6">
        <h2 class="text-lg font-semibold text-slate-100">Events summary</h2>
        <div class="mt-4 grid gap-4 sm:grid-cols-3">
            <div class="rounded-xl border border-slate-800 bg-slate-950/60 p-4 text-center">
                <p class="text-xs uppercase tracking-widest text-slate-500">Events</p>
                <p class="mt-1 text-2xl font-semibold text-slate-100">{{ events_count }}</p>
            </div>
            <div class="rounded-xl border border-slate-800 bg-slate-950/60 p-4 text-center">
                <p class="text-xs uppercase tracking-widest text-slate-500">Entries</p>
                <p class="mt-1 text-2xl font-semibold text-slate-100">{{ entries_total }}</p>
            </div>
            <div class="rounded-xl border border-slate-800 bg-slate-950/60 p-4 text-center">
                <p class="text-xs uppercase tracking-widest text-slate-500">Students participating</p>
                <p class="mt-1 text-2xl font-semibold text-slate-100">{{ students_total }}</p>
            </div>
        </div>
        <div class="mt-6 flex flex-wrap gap-2 text-sm">
            <a href="{% url 'sportsday:events' %}?meet={{ meet.slug }}" class="inline-flex items-center gap-2 rounded-full bg-sky-500/10 px-4 py-2 text-sky-200 hover:bg-sky-500/20">Manage events</a>
            <a href="{% url 'sportsday:events-generate' meet.slug %}" class="inline-flex items-center gap-2 rounded-full border border-dashed border-sky-500/40 px-4 py-2 text-sky-200 hover:border-sky-500 hover:text-sky-100">Bulk generate events</a>
            <a href="{% url 'sportsday:entries-bulk' meet.slug %}" class="inline-flex items-center gap-2 rounded-full border border-dashed border-emerald-500/40 px-4 py-2 text-emerald-200 hover:border-emerald-500 hover:text-emerald-100">Bulk assign entries</a>
            <a href="{% url 'sportsday:event-reassign' %}" class="inline-flex items-center gap-2 rounded-full border border-slate-700 px-4 py-2 text-slate-300 hover:border-sky-500/40 hover:text-sky-200">Move events between meets</a>
        </div>
    </section>

    <section id="tab-entries" class="rounded-2xl border border-slate-800 bg-slate-900/60 p-6">
        <h2 class="text-lg font-semibold text-slate-100">Entries &amp; clashes</h2>
        <p class="mt-2 text-sm text-slate-400">Use the bulk tools to respect capacity, division rules, and timetable clashes. Individual start lists can be edited from each event.</p>
        <div class="mt-4 grid gap-4 sm:grid-cols-2">
            <a href="{% url 'sportsday:entries-bulk' meet.slug %}" class="rounded-xl border border-slate-800 bg-slate-950/60 px-4 py-4 text-sm text-slate-200 hover:border-emerald-500/40">
                <span class="block text-sm font-semibold text-emerald-200">Bulk assignment</span>
                <span class="block text-xs text-slate-400">Auto-fill start lists with fair house distribution.</span>
            </a>
            {% if highlight_event %}
                <a href="{% url 'sportsday:export-startlists-csv' %}?event={{ highlight_event }}" class="rounded-xl border border-slate-800 bg-slate-950/60 px-4 py-4 text-sm text-slate-200 hover:border-sky-500/40">
                    <span class="block text-sm font-semibold text-sky-200">Export start lists</span>
                    <span class="block text-xs text-slate-400">Download CSVs for marshals and lane draws.</span>
                </a>
            {% else %}
                <span class="rounded-xl border border-dashed border-slate-800 bg-slate-950/40 px-4 py-4 text-xs text-slate-400">
                    <span class="block text-sm font-semibold text-slate-200">Export start lists</span>
                    <span class="block">Create an event to enable exports.</span>
                </span>
            {% endif %}
        </div>
    </section>

    <section id="tab-scoring" class="rounded-2xl border border-slate-800 bg-slate-900/60 p-6">
        <h2 class="text-lg font-semibold text-slate-100">Scoring settings</h2>
        {% if scoring_rule %}
            <dl class="mt-3 grid gap-3 sm:grid-cols-3 text-sm text-slate-300">
                <div>
                    <dt class="text-xs uppercase tracking-widest text-slate-500">Points</dt>
                    <dd class="font-medium">{{ scoring_rule.points_csv }}</dd>
                </div>
                <div>
                    <dt class="text-xs uppercase tracking-widest text-slate-500">Participation</dt>
                    <dd class="font-medium">{{ scoring_rule.participation_point }}</dd>
                </div>
                <div>
                    <dt class="text-xs uppercase tracking-widest text-slate-500">Tie method</dt>
                    <dd class="font-medium">{{ scoring_rule.get_tie_method_display }}</dd>
                </div>
            </dl>
        {% else %}
            <p class="mt-2 text-sm text-slate-400">No scoring rule configured yet. Edit the meet to define points.</p>
        {% endif %}
        <div class="mt-4">
            <a href="{% url 'sportsday:leaderboards' %}?meet={{ meet.slug }}" class="inline-flex items-center gap-2 rounded-full border border-slate-700 px-4 py-2 text-sm text-slate-300 hover:border-sky-500/40 hover:text-sky-200">View leaderboards</a>
        </div>
    </section>

    <section id="tab-exports" class="rounded-2xl border border-slate-800 bg-slate-900/60 p-6">
        <h2 class="text-lg font-semibold text-slate-100">Exports</h2>
        <ul class="mt-3 space-y-2 text-sm text-slate-300">
            <li><a href="{% url 'sportsday:export-students-csv' %}" class="text-sky-300 hover:text-sky-200">Download students CSV</a></li>
            <li><a href="{% url 'sportsday:export-teachers-csv' %}" class="text-sky-300 hover:text-sky-200">Download teachers CSV</a></li>
            <li><a href="{% url 'sportsday:export-startlists-csv' %}" class="text-sky-300 hover:text-sky-200">Export start lists (choose event id)</a></li>
            <li><a href="{% url 'sportsday:export-results-csv' %}" class="text-sky-300 hover:text-sky-200">Export results CSV</a></li>
            <li><a href="{% url 'sportsday:export-leaderboard-csv' %}" class="text-sky-300 hover:text-sky-200">Export leaderboard CSV</a></li>
        </ul>
    </section>
</section>
{% endblock %}
{% block mobile_nav %}
    {% if mobile_nav %}
        <nav class="fixed bottom-0 inset-x-0 z-40 border-t border-slate-800 bg-dusk/95 backdrop-blur md:hidden">
            <ul class="grid grid-cols-4 text-xs font-medium text-slate-300">
                {% for item in mobile_nav %}
                    <li>
                        <a href="{{ item.url }}" class="flex flex-col items-center justify-center gap-1 py-3 {% if item.label|lower == mobile_nav_active %}text-sky-300{% else %}hover:text-sky-200{% endif %}">
                            <span>{{ item.label }}</span>
                        </a>
                    </li>
                {% endfor %}
            </ul>
        </nav>
    {% endif %}
{% endblock %}
