{% extends "sportsday/base.html" %}
{% block title %}Sports Day · {{ event.name }}{% endblock %}
{% block content %}
<section class="space-y-6">
    <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
        <div>
            <p class="text-sm uppercase tracking-widest text-slate-600">Event control</p>
            <h1 class="text-2xl font-semibold text-ink">{{ event.name }}</h1>
            <p class="text-sm text-slate-600">{{ event.meet.name }} · {{ event.get_gender_limit_display }} · Grades {{ event.grade_min }}–{{ event.grade_max }}</p>
        </div>
        <div class="flex flex-wrap gap-2">
            <a href="{% url 'sportsday:events' %}?meet={{ event.meet.slug }}" class="inline-flex items-center gap-2 rounded-full border border-slate-300 px-4 py-2 text-sm text-slate-700 hover:border-sky-500 hover:text-sky-700">Back to events</a>
            <a href="{% url 'sportsday:event-results-qr' event.pk %}" target="_blank" rel="noopener" class="inline-flex items-center gap-2 rounded-full border border-slate-300 px-4 py-2 text-sm text-slate-700 hover:border-sky-500 hover:text-sky-700">QR Code</a>
            <a href="{% url 'sportsday:event-start-list-printable' event.pk %}" target="_blank" rel="noopener" class="inline-flex items-center gap-2 rounded-full border border-slate-300 px-4 py-2 text-sm text-slate-700 hover:border-sky-500 hover:text-sky-700">Print start list</a>
            <form method="post" action="{% url 'sportsday:event-toggle-lock' event.pk %}" hx-post="{% url 'sportsday:event-toggle-lock' event.pk %}" hx-target="closest section" hx-swap="outerHTML">
                {% csrf_token %}
                {% if event.is_locked %}
                    <input type="hidden" name="action" value="unlock">
                    <button type="submit" class="inline-flex items-center gap-2 rounded-full bg-emerald-100 px-4 py-2 text-sm font-medium text-emerald-700 hover:bg-emerald-200">Unlock event</button>
                {% else %}
                    <input type="hidden" name="action" value="lock">
                    <button type="submit" class="inline-flex items-center gap-2 rounded-full bg-rose-100 px-4 py-2 text-sm font-medium text-rose-700 hover:bg-rose-200">Lock event</button>
                {% endif %}
            </form>
        </div>
    </div>

    <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-sm">
        <div class="flex flex-wrap items-center gap-3 text-sm text-slate-700">
            <span class="inline-flex items-center gap-2 rounded-full border border-slate-300 px-3 py-1 text-xs uppercase tracking-widest">{{ event.sport_type.label }}</span>
            <span class="inline-flex items-center gap-2 rounded-full border border-slate-300 px-3 py-1 text-xs uppercase tracking-widest">{{ event.capacity }} slots</span>
            <span class="inline-flex items-center gap-2 rounded-full border border-slate-300 px-3 py-1 text-xs uppercase tracking-widest">{{ event.attempts }} attempts</span>
            {% if event.schedule_dt %}
                <span class="inline-flex items-center gap-2 rounded-full border border-slate-300 px-3 py-1 text-xs uppercase tracking-widest">{{ event.schedule_dt|date:"D j M" }} · {{ event.schedule_dt|time:"H:i" }}</span>
            {% else %}
                <span class="inline-flex items-center gap-2 rounded-full border border-amber-400/70 text-amber-600 px-3 py-1 text-xs uppercase tracking-widest bg-amber-50">Unscheduled</span>
            {% endif %}
            {% if event.meet.is_locked %}
                <span class="inline-flex items-center gap-2 rounded-full border border-rose-300 bg-rose-50 px-3 py-1 text-xs uppercase tracking-widest text-rose-700">Meet locked</span>
            {% elif event.is_locked %}
                <span class="inline-flex items-center gap-2 rounded-full border border-emerald-300 bg-emerald-50 px-3 py-1 text-xs uppercase tracking-widest text-emerald-700">Event locked</span>
            {% endif %}
        </div>
    </div>

    <div class="space-y-4">
        <nav class="rounded-full border border-slate-200 bg-white p-1 text-sm font-medium text-slate-700 shadow-sm" hx-target="#event-tab-content" hx-swap="innerHTML">
            <ul class="grid grid-cols-3">
                <li><a href="{% url 'sportsday:event-start-list-fragment' event.pk %}" hx-get="{% url 'sportsday:event-start-list-fragment' event.pk %}" hx-trigger="click" class="block rounded-full px-4 py-2 text-center hover:bg-slate-100" data-tab="start" hx-push-url="false">Start Lists</a></li>
                <li><a href="{% url 'sportsday:event-results-fragment' event.pk %}" hx-get="{% url 'sportsday:event-results-fragment' event.pk %}" hx-trigger="click" class="block rounded-full px-4 py-2 text-center hover:bg-slate-100" data-tab="results" hx-push-url="false">Enter Results</a></li>
                <li><a href="{% url 'sportsday:event-printables-fragment' event.pk %}" hx-get="{% url 'sportsday:event-printables-fragment' event.pk %}" hx-trigger="click" class="block rounded-full px-4 py-2 text-center hover:bg-slate-100" data-tab="printables" hx-push-url="false">Printables</a></li>
            </ul>
        </nav>
        <div id="event-tab-content" class="rounded-2xl border border-slate-200 bg-white p-5 shadow-sm" hx-get="{% url 'sportsday:event-start-list-fragment' event.pk %}" hx-trigger="load">
            <div class="rounded-xl border border-slate-200 bg-slate-50 p-4 text-sm text-slate-600">Loading event details…</div>
        </div>
    </div>
</section>
{% endblock %}
{% block mobile_nav %}
    {% if mobile_nav %}
        <nav class="fixed bottom-0 inset-x-0 z-40 border-t border-slate-200 bg-white/95 backdrop-blur md:hidden">
            <ul class="grid grid-cols-4 text-xs font-medium text-slate-700">
                {% for item in mobile_nav %}
                    <li>
                        <a href="{{ item.url }}" class="flex flex-col items-center justify-center gap-1 py-3 {% if item.label|lower == mobile_nav_active %}text-sky-700 font-semibold{% else %}hover:text-sky-600{% endif %}">
                            <span>{{ item.label }}</span>
                        </a>
                    </li>
                {% endfor %}
            </ul>
        </nav>
    {% endif %}
{% endblock %}
