{% extends "sportsday/base.html" %}
{% block title %}Sports Day Â· Sports Library{% endblock %}
{% block content %}
<section class="space-y-6">
    <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
        <div>
            <p class="text-sm uppercase tracking-widest text-slate-400">Configuration</p>
            <h1 class="text-2xl font-semibold">Sports library</h1>
            <p class="text-sm text-slate-400">Add, edit, or remove sport templates available when building events.</p>
        </div>
        <a href="{% url 'sportsday:meet-create' %}?step=events" class="inline-flex items-center gap-2 rounded-full border border-slate-700 px-4 py-2 text-sm text-slate-300 hover:border-sky-500/40 hover:text-sky-200">Go to event builder</a>
    </div>

    <div class="grid gap-6 lg:grid-cols-[3fr,2fr]">
        <div class="space-y-3">
            {% for sport in sports %}
                <article class="rounded-2xl border {% if selected_sport and sport.pk == selected_sport.pk %}border-sky-500 bg-sky-500/10{% else %}border-slate-800 bg-slate-900/60{% endif %} p-4">
                    <div class="flex flex-wrap items-center justify-between gap-3">
                        <div>
                            <h2 class="text-lg font-semibold text-slate-100">{{ sport.label }}</h2>
                            <p class="text-xs uppercase tracking-widest text-slate-400">Key: {{ sport.key }}</p>
                        </div>
                        <div class="flex gap-2 text-sm">
                            <a href="{% url 'sportsday:sport-types' %}?sport={{ sport.pk }}" class="inline-flex items-center gap-2 rounded-full border border-slate-700 px-3 py-1 text-slate-200 hover:border-sky-500/40 hover:text-sky-200">Edit</a>
                            <form method="post" action="{% url 'sportsday:sport-types' %}" onsubmit="return confirm('Remove {{ sport.label }}? This cannot be undone.');">
                                {% csrf_token %}
                                <input type="hidden" name="action" value="delete">
                                <input type="hidden" name="sport_id" value="{{ sport.pk }}">
                                <button type="submit" class="inline-flex items-center gap-2 rounded-full border border-rose-400/60 px-3 py-1 text-rose-400 hover:border-rose-400 hover:text-rose-300">Delete</button>
                            </form>
                        </div>
                    </div>
                    <dl class="mt-3 grid gap-3 text-xs text-slate-300 sm:grid-cols-2">
                        <div>
                            <dt class="uppercase tracking-widest text-slate-500">Archetype</dt>
                            <dd class="font-semibold">{{ sport.get_archetype_display }}</dd>
                        </div>
                        <div>
                            <dt class="uppercase tracking-widest text-slate-500">Default unit</dt>
                            <dd class="font-semibold">{{ sport.get_default_unit_display }}</dd>
                        </div>
                        <div>
                            <dt class="uppercase tracking-widest text-slate-500">Capacity</dt>
                            <dd class="font-semibold">{{ sport.default_capacity }}</dd>
                        </div>
                        <div>
                            <dt class="uppercase tracking-widest text-slate-500">Attempts</dt>
                            <dd class="font-semibold">{{ sport.default_attempts }}</dd>
                        </div>
                        <div>
                            <dt class="uppercase tracking-widest text-slate-500">Supports heats</dt>
                            <dd class="font-semibold">{% if sport.supports_heats %}Yes{% else %}No{% endif %}</dd>
                        </div>
                        <div>
                            <dt class="uppercase tracking-widest text-slate-500">Supports finals</dt>
                            <dd class="font-semibold">{% if sport.supports_finals %}Yes{% else %}No{% endif %}</dd>
                        </div>
                        <div>
                            <dt class="uppercase tracking-widest text-slate-500">Requires time for gold</dt>
                            <dd class="font-semibold">{% if sport.requires_time_for_first_place %}Yes{% else %}No{% endif %}</dd>
                        </div>
                        {% if sport.notes %}
                            <div class="sm:col-span-2">
                                <dt class="uppercase tracking-widest text-slate-500">Notes</dt>
                                <dd class="text-slate-200">{{ sport.notes }}</dd>
                            </div>
                        {% endif %}
                    </dl>
                </article>
            {% empty %}
                <div class="rounded-2xl border border-dashed border-slate-700 bg-slate-900/40 p-6 text-sm text-slate-400">
                    No sports configured yet. Add your first sport using the form.
                </div>
            {% endfor %}
        </div>
        <div class="rounded-2xl border border-slate-800 bg-slate-900/60 p-5">
            <h2 class="text-lg font-semibold text-slate-100">{% if selected_sport %}Edit {{ selected_sport.label }}{% else %}Add a sport{% endif %}</h2>
            <form method="post" action="{% url 'sportsday:sport-types' %}" class="mt-4 space-y-4">
                {% csrf_token %}
                {% if selected_sport %}
                    <input type="hidden" name="sport_id" value="{{ selected_sport.pk }}">
                {% endif %}
                {% if form.non_field_errors %}
                    <div class="rounded-lg border border-rose-500/60 bg-rose-500/10 px-4 py-2 text-sm text-rose-200">
                        {% for error in form.non_field_errors %}
                            <div>{{ error }}</div>
                        {% endfor %}
                    </div>
                {% endif %}
                <div class="space-y-2">
                    <label for="id_key" class="text-sm font-medium text-slate-200">Key</label>
                    {{ form.key }}
                    {% if form.key.errors %}
                        <p class="text-xs text-rose-300">{{ form.key.errors|join:', ' }}</p>
                    {% endif %}
                </div>
                <div class="space-y-2">
                    <label for="id_label" class="text-sm font-medium text-slate-200">Label</label>
                    {{ form.label }}
                    {% if form.label.errors %}
                        <p class="text-xs text-rose-300">{{ form.label.errors|join:', ' }}</p>
                    {% endif %}
                </div>
                <div class="space-y-2">
                    <label for="id_archetype" class="text-sm font-medium text-slate-200">Archetype</label>
                    {{ form.archetype }}
                    {% if form.archetype.errors %}
                        <p class="text-xs text-rose-300">{{ form.archetype.errors|join:', ' }}</p>
                    {% endif %}
                </div>
                <div class="space-y-2">
                    <label for="id_default_unit" class="text-sm font-medium text-slate-200">Default unit</label>
                    {{ form.default_unit }}
                    {% if form.default_unit.errors %}
                        <p class="text-xs text-rose-300">{{ form.default_unit.errors|join:', ' }}</p>
                    {% endif %}
                </div>
                <div class="grid gap-4 sm:grid-cols-2">
                    <div class="space-y-2">
                        <label for="id_default_capacity" class="text-sm font-medium text-slate-200">Default capacity</label>
                        {{ form.default_capacity }}
                        {% if form.default_capacity.errors %}
                            <p class="text-xs text-rose-300">{{ form.default_capacity.errors|join:', ' }}</p>
                        {% endif %}
                    </div>
                    <div class="space-y-2">
                        <label for="id_default_attempts" class="text-sm font-medium text-slate-200">Default attempts</label>
                        {{ form.default_attempts }}
                        {% if form.default_attempts.errors %}
                            <p class="text-xs text-rose-300">{{ form.default_attempts.errors|join:', ' }}</p>
                        {% endif %}
                    </div>
                </div>
                <div class="space-y-2">
                    <label class="text-sm font-medium text-slate-200">Options</label>
                    <div class="space-y-2 rounded-lg border border-slate-800 bg-slate-950/60 p-3 text-sm text-slate-200">
                        <label class="flex items-center gap-2">
                            {{ form.supports_heats }}
                            <span>Supports heats</span>
                        </label>
                        <label class="flex items-center gap-2">
                            {{ form.supports_finals }}
                            <span>Supports finals</span>
                        </label>
                        <label class="flex items-center gap-2">
                            {{ form.requires_time_for_first_place }}
                            <span>Requires time for first place</span>
                        </label>
                    </div>
                    {% if form.supports_heats.errors or form.supports_finals.errors or form.requires_time_for_first_place.errors %}
                        <p class="text-xs text-rose-300">Check the options provided.</p>
                    {% endif %}
                </div>
                <div class="space-y-2">
                    <label for="id_notes" class="text-sm font-medium text-slate-200">Notes</label>
                    {{ form.notes }}
                    {% if form.notes.errors %}
                        <p class="text-xs text-rose-300">{{ form.notes.errors|join:', ' }}</p>
                    {% endif %}
                </div>
                <div class="flex flex-wrap items-center justify-between gap-2">
                    {% if selected_sport %}
                        <a href="{% url 'sportsday:sport-types' %}" class="text-sm text-slate-400 hover:text-slate-200">Cancel editing</a>
                    {% else %}
                        <span></span>
                    {% endif %}
                    <button type="submit" name="action" value="save" class="inline-flex items-center gap-2 rounded-full bg-sky-500 px-5 py-2 text-sm font-medium text-slate-900 shadow-lg shadow-sky-500/40 hover:bg-sky-400">Save sport</button>
                </div>
            </form>
        </div>
    </div>
</section>
{% endblock %}
